<!-- templates/components/inference_form.html -->
<!-- Live inference form: interactive, HTMX-driven, safe from overlay/focus issues -->

<div class="bg-white rounded-[2.5rem] shadow-2xl shadow-blue-900/10 border border-slate-200 overflow-hidden">
    <div class="p-6 sm:p-10 space-y-8">

        <!-- Inference form -->
        <form
            hx-post="/predict-ui"
            hx-target="#result-area"
            hx-indicator="#inference-loader"
            class="space-y-6"
        >

            <div class="space-y-3">
                <div class="flex justify-between items-center px-1">
                    <label
                        for="text"
                        class="text-[10px] font-black uppercase tracking-widest text-slate-400"
                    >
                        Natural Language Stream
                    </label>
                    <span class="text-[10px] font-mono text-slate-300">
                        UTF-8 Input
                    </span>
                </div>

                <textarea
                    name="text"
                    id="text"
                    rows="2"
                    class="w-full px-6 py-5 bg-slate-50 border-2 border-slate-100 rounded-2xl
                           focus:border-blue-500 focus:bg-white outline-none transition-all
                           text-xl sm:text-2xl placeholder-slate-300 resize-none font-medium shadow-inner"
                    placeholder="Analyze the vibe... âœ¨"
                    required
                ></textarea>
            </div>

            <button
                type="submit"
                class="w-full bg-slate-900 hover:bg-blue-700 text-white font-bold py-5
                       rounded-2xl transition-all shadow-lg active:scale-[0.98]
                       flex items-center justify-center gap-3 group"
            >
                <span class="tracking-wide text-sm uppercase">
                    Execute Classification
                </span>
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="2.5"
                    stroke="currentColor"
                    class="w-5 h-5 group-hover:translate-x-1 transition-transform"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"
                    />
                </svg>
            </button>
        </form>

        <!-- Result + loader area -->
        <div
            id="result-area"
            class="relative min-h-[140px] border-t border-slate-50 flex"
        >

            <!-- Awaiting input state -->
            <div
                class="flex flex-col items-center justify-center w-full text-center
                       space-y-2 opacity-40 group-[.htmx-request]:hidden"
            >
                <p class="text-xs font-mono uppercase tracking-widest">
                    Awaiting Input
                </p>
                <div class="flex justify-center gap-1">
                    <span class="h-1 w-1 rounded-full bg-slate-400 animate-pulse"></span>
                    <span class="h-1 w-1 rounded-full bg-slate-400 animate-pulse [animation-delay:200ms]"></span>
                    <span class="h-1 w-1 rounded-full bg-slate-400 animate-pulse [animation-delay:400ms]"></span>
                </div>
            </div>

            <!-- HTMX loader (scoped + non-blocking) -->
            <div
                id="inference-loader"
                class="htmx-indicator absolute inset-0 pointer-events-none
                       flex flex-col items-center justify-center gap-4 text-blue-600"
            >
                <div
                    class="animate-spin h-10 w-10 border-[4px]
                           border-blue-600 border-t-transparent rounded-full shadow-sm"
                ></div>
                <span
                    class="text-[10px] font-black uppercase tracking-[0.2em] animate-pulse"
                >
                    Computing Probability...
                </span>
            </div>

        </div>

    </div>
</div>

<script>
document.addEventListener("keydown", function (e) {
    const textarea = document.getElementById("text");
    if (!textarea) return;

    if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        textarea.closest("form").requestSubmit();
    }
});
</script>
